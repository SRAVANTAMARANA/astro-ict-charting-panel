<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Chart Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .container {
            display: flex;
            height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            gap: 20px;
        }
        
        .chart-container {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            min-height: 500px;
        }
        
        .chart-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .chart-controls {
            display: flex;
            gap: 10px;
        }
        
        select, button {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
        }
        
        button {
            background-color: #4a6cf7;
            color: white;
            border: none;
        }
        
        button:hover {
            background-color: #3a5ce5;
        }
        
        #chart {
            flex: 1;
            width: 100%;
        }
        
        .sidebar {
            width: 300px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .log-container {
            flex: 1;
            overflow-y: auto;
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }
        
        .status {
            margin-top: 15px;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }
        
        .status.idle {
            background-color: #f0f9ff;
            color: #0369a1;
        }
        
        .status.loading {
            background-color: #fffbeb;
            color: #b45309;
        }
        
        .status.success {
            background-color: #f0fdf4;
            color: #15803d;
        }
        
        .status.error {
            background-color: #fef2f2;
            color: #b91c1c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">Financial Chart</div>
                <div class="chart-controls">
                    <select id="symbol">
                        <option value="XAUUSD">XAUUSD</option>
                        <option value="BTCUSDT">BTCUSDT</option>
                        <option value="EURUSD">EURUSD</option>
                    </select>
                    <select id="interval">
                        <option value="1min">1m</option>
                        <option value="5min" selected>5m</option>
                        <option value="1h">1h</option>
                        <option value="1d">1d</option>
                    </select>
                    <button id="loadBtn">Load Data</button>
                    <button id="tvBtn">Open TradingView</button>
                </div>
            </div>
            <div id="chart"></div>
        </div>
        
        <div class="sidebar">
            <div class="sidebar-title">Logs</div>
            <div id="log" class="log-container">Ready to load data...</div>
            <div id="status" class="status idle">Status: Idle</div>
        </div>
    </div>

    <!-- Lightweight Charts Library -->
    <script src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if the library is loaded
            if (typeof LightweightCharts === 'undefined') {
                document.getElementById('log').textContent = 'ERROR: LightweightCharts library not loaded!';
                document.getElementById('status').textContent = 'Status: Error';
                document.getElementById('status').className = 'status error';
                return;
            }
            
            // DOM Elements
            const chartElement = document.getElementById('chart');
            const logElement = document.getElementById('log');
            const statusElement = document.getElementById('status');
            const symbolSelect = document.getElementById('symbol');
            const intervalSelect = document.getElementById('interval');
            const loadButton = document.getElementById('loadBtn');
            const tvButton = document.getElementById('tvBtn');
            
            // Chart variables
            let chart = null;
            let candlestickSeries = null;
            
            // Log function
            function log(message, isError = false) {
                const timestamp = new Date().toLocaleTimeString();
                const logMessage = `[${timestamp}] ${message}\n`;
                logElement.textContent += logMessage;
                logElement.scrollTop = logElement.scrollHeight;
                
                if (isError) {
                    statusElement.textContent = 'Status: Error';
                    statusElement.className = 'status error';
                }
            }
            
            // Update status function
            function updateStatus(status, type = 'idle') {
                statusElement.textContent = `Status: ${status}`;
                statusElement.className = `status ${type}`;
            }
            
            // Create chart function
            function createChart() {
                try {
                    // Remove existing chart if any
                    if (chart) {
                        chart.remove();
                        chart = null;
                        candlestickSeries = null;
                    }
                    
                    // Create new chart
                    chart = LightweightCharts.createChart(chartElement, {
                        width: chartElement.clientWidth,
                        height: chartElement.clientHeight,
                        layout: {
                            backgroundColor: '#ffffff',
                            textColor: '#333',
                        },
                        grid: {
                            vertLines: {
                                color: '#f0f0f0',
                            },
                            horzLines: {
                                color: '#f0f0f0',
                            },
                        },
                        timeScale: {
                            borderVisible: false,
                        },
                        rightPriceScale: {
                            borderVisible: false,
                        },
                        crosshair: {
                            mode: LightweightCharts.CrosshairMode.Normal,
                        },
                    });
                    
                    // Add candlestick series
                    candlestickSeries = chart.addCandlestickSeries({
                        upColor: '#26a69a',
                        downColor: '#ef5350',
                        borderDownColor: '#ef5350',
                        borderUpColor: '#26a69a',
                        wickDownColor: '#ef5350',
                        wickUpColor: '#26a69a',
                    });
                    
                    log('Chart created successfully');
                    updateStatus('Chart created', 'success');
                    return true;
                } catch (error) {
                    log(`Error creating chart: ${error.message}`, true);
                    console.error(error);
                    return false;
                }
            }
            
            // Generate sample data
            function generateSampleData() {
                const data = [];
                let time = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000); // 30 days ago
                
                let value = Math.random() * 100 + 100; // Random starting value between 100-200
                
                for (let i = 0; i < 100; i++) {
                    const open = value;
                    const change = (Math.random() - 0.5) * 5;
                    const close = value + change;
                    const high = Math.max(open, close) + Math.random() * 2;
                    const low = Math.min(open, close) - Math.random() * 2;
                    
                    data.push({
                        time: time.getTime() / 1000, // Convert to Unix timestamp
                        open: open,
                        high: high,
                        low: low,
                        close: close,
                    });
                    
                    value = close;
                    time = new Date(time.getTime() + 5 * 60 * 1000); // Add 5 minutes
                }
                
                return data;
            }
            
            // Load data function
            async function loadData() {
                const symbol = symbolSelect.value;
                const interval = intervalSelect.value;
                
                updateStatus('Loading data', 'loading');
                log(`Loading data for ${symbol} with interval ${interval}`);
                
                try {
                    // In a real application, you would fetch data from your API
                    // For this example, we'll generate sample data
                    const sampleData = generateSampleData();
                    
                    // Set data to the chart
                    candlestickSeries.setData(sampleData);
                    
                    // Fit content
                    chart.timeScale().fitContent();
                    
                    log(`Data loaded successfully for ${symbol}`);
                    updateStatus('Data loaded', 'success');
                } catch (error) {
                    log(`Error loading data: ${error.message}`, true);
                    console.error(error);
                }
            }
            
            // Event listeners
            loadButton.addEventListener('click', loadData);
            
            tvButton.addEventListener('click', function() {
                window.open('https://www.tradingview.com/chart/', '_blank');
            });
            
            // Handle window resize
            window.addEventListener('resize', function() {
                if (chart) {
                    chart.applyOptions({
                        width: chartElement.clientWidth,
                        height: chartElement.clientHeight,
                    });
                }
            });
            
            // Initialize the application
            function init() {
                log('Initializing application...');
                
                if (createChart()) {
                    loadData();
                }
            }
            
            // Start the application
            init();
        });
    </script>
</body>
</html>
